{"version":3,"sources":["../../../../src/app/tenant/%5Bslug%5D/courses/%5BcourseSlug%5D/%5BlessonSlug%5D/page.tsx"],"sourcesContent":["import { prisma } from '@/lib/prisma';\r\nimport { notFound } from 'next/navigation';\r\n\r\nexport default async function LessonPage({\r\n    params\r\n}: {\r\n    params: Promise<{ slug: string, courseSlug: string, lessonSlug: string }>\r\n}) {\r\n    const resolvedParams = await params;\r\n    const { slug, courseSlug, lessonSlug } = resolvedParams;\r\n\r\n    const tenant = await prisma.tenant.findUnique({ where: { slug } });\r\n    if (!tenant) notFound();\r\n\r\n    // Verify Course exists in Tenant\r\n    const course = await prisma.course.findUnique({\r\n        where: {\r\n            tenantId_slug: { tenantId: tenant.id, slug: courseSlug }\r\n        }\r\n    });\r\n    if (!course) notFound();\r\n\r\n    // Fetch Lesson + Previous/Next context logic could be added here\r\n    // Note: We need to filter by tenant/course implicitly via the module relations, \r\n    // or just fetch by slug and verify parentage.\r\n    // Simplest: FindFirst where slug = lessonSlug AND module.course.id = course.id\r\n    const lesson = await prisma.lesson.findFirst({\r\n        where: {\r\n            slug: lessonSlug,\r\n            module: {\r\n                courseId: course.id\r\n            }\r\n        }\r\n    });\r\n\r\n    if (!lesson) {\r\n        notFound();\r\n    }\r\n\r\n    // Helper function to embed videos\r\n    const getVideoEmbed = (url: string) => {\r\n        if (!url) return null;\r\n        if (url.includes('youtube.com') || url.includes('youtu.be')) {\r\n            const videoId = url.split('v=')[1] || url.split('/').pop();\r\n            return `https://www.youtube.com/embed/${videoId}`;\r\n        }\r\n        if (url.includes('vimeo')) {\r\n            const videoId = url.split('/').pop();\r\n            return `https://player.vimeo.com/video/${videoId}`;\r\n        }\r\n        return null;\r\n        // fallback for direct mp4?? No, let's assume iframe compatible for now.\r\n    }\r\n\r\n    const embedUrl = lesson.videoUrl ? getVideoEmbed(lesson.videoUrl) : null;\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full bg-white dark:bg-black\">\r\n            {/* Video Player Area */}\r\n            {embedUrl ? (\r\n                <div className=\"w-full bg-black aspect-video\">\r\n                    <iframe\r\n                        src={embedUrl}\r\n                        className=\"w-full h-full\"\r\n                        allowFullScreen\r\n                        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\r\n                    ></iframe>\r\n                </div>\r\n            ) : (\r\n                lesson.videoUrl && (\r\n                    <div className=\"w-full p-8 bg-gray-100 text-center\">\r\n                        <p>Video URL no soportada para embed simple: <a href={lesson.videoUrl} target=\"_blank\" className=\"underline text-blue-600\">{lesson.videoUrl}</a></p>\r\n                    </div>\r\n                )\r\n            )}\r\n\r\n            {/* Content Area */}\r\n            <div className=\"flex-1 p-8 max-w-4xl mx-auto w-full\">\r\n                <h1 className=\"text-3xl font-bold mb-6\">{lesson.title}</h1>\r\n\r\n                {lesson.content && (\r\n                    <div className=\"prose dark:prose-invert max-w-none\">\r\n                        {/* We should sanitize HTML if we were allowing rich text, but for admin-generated content, simple render is \"okay\" for MVP if we trust admin.\r\n                            Actually, we don't have a markdown parser installed yet. \r\n                            Let's assume content is plain text or simple HTML for now.\r\n                            For MVP, simple whitespace preservation.\r\n                        */}\r\n                        <div className=\"whitespace-pre-wrap font-sans text-gray-800 dark:text-gray-300\">\r\n                            {lesson.content}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"0YAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAEe,eAAe,EAAW,QACrC,CAAM,CAGT,EAEG,GAAM,MAAE,CAAI,YAAE,CAAU,YAAE,CAAU,CAAE,CADf,EACkB,IADZ,EAGvB,EAAS,MAAM,EAAA,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAE,MAAO,MAAE,CAAK,CAAE,EAC5D,CAAC,GAAQ,CAAA,EAAA,EAAA,QAAA,AAAQ,IAGrB,IAAM,EAAS,MAAM,EAAA,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAC1C,MAAO,CACH,cAAe,CAAE,SAAU,EAAO,EAAE,CAAE,KAAM,CAAW,CAC3D,CACJ,EACI,CAAC,GAAQ,CAAA,EAAA,EAAA,QAAA,AAAQ,IAMrB,IAAM,EAAS,MAAM,EAAA,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CACzC,MAAO,CACH,KAAM,EACN,OAAQ,CACJ,SAAU,EAAO,EACrB,AADuB,CAE3B,CACJ,EAEI,CAAC,GACD,CAAA,EAAA,EADS,AACT,QAAA,AAAQ,IAkBZ,IAAM,EAAW,EAAO,QAAQ,CAAG,CAdb,AAAC,IACnB,GAAI,CAAC,EAAK,OAAO,KACjB,GAAI,EAAI,QAAQ,CAAC,gBAAkB,EAAI,QAAQ,CAAC,YAAa,CACzD,IAAM,EAAU,EAAI,KAAK,CAAC,KAAK,CAAC,EAAE,EAAI,EAAI,KAAK,CAAC,KAAK,GAAG,GACxD,MAAO,CAAC,8BAA8B,EAAE,EAAA,CAC5C,AADqD,CAErD,GAAI,EAAI,QAAQ,CAAC,SAAU,CACvB,IAAM,EAAU,EAAI,KAAK,CAAC,KAAK,GAAG,GAClC,MAAO,CAAC,+BAA+B,EAAE,EAAA,CAAS,AACtD,CACA,OAAO,KAEX,EAEiD,EAAO,QAAQ,EAAI,KAEpE,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wDAEV,EACG,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wCACX,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACG,IAAK,EACL,UAAU,gBACV,eAAe,CAAA,CAAA,EACf,MAAM,+FAId,EAAO,QAAQ,EACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8CACX,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,WAAE,6CAA0C,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,KAAM,EAAO,QAAQ,CAAE,OAAO,SAAS,UAAU,mCAA2B,EAAO,QAAQ,QAMvJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gDACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mCAA2B,EAAO,KAAK,GAEpD,EAAO,OAAO,EACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8CAMX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0EACV,EAAO,OAAO,UAO3C"}