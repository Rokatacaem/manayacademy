{"version":3,"sources":["../../../../src/app/tenant/%5Bslug%5D/admin/tags/page.tsx","../../../../src/actions/tags.ts","../../../../.next-internal/server/app/tenant/%5Bslug%5D/admin/tags/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { prisma } from '@/lib/prisma';\r\nimport { Button } from '@/components/ui/Button';\r\nimport { createTag, deleteTag } from '@/actions/tags';\r\nimport { notFound } from 'next/navigation';\r\n\r\nexport default async function TagsPage({ params }: { params: Promise<{ slug: string }> }) {\r\n    const { slug } = await params;\r\n    const tenant = await prisma.tenant.findUnique({ where: { slug } });\r\n\r\n    if (!tenant) notFound();\r\n\r\n    const tags = await prisma.tag.findMany({\r\n        where: { tenantId: tenant.id },\r\n        orderBy: { name: 'asc' },\r\n        include: { _count: { select: { contacts: true } } }\r\n    });\r\n\r\n    const createTagWithTenant = createTag.bind(null, tenant.id);\r\n    const deleteTagWithTenant = deleteTag.bind(null, tenant.id);\r\n\r\n    return (\r\n        <div className=\"space-y-6 max-w-4xl\">\r\n            <h1 className=\"text-2xl font-bold tracking-tight\">Gesti√≥n de Etiquetas</h1>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\r\n                {/* Create Tag Form */}\r\n                <div className=\"md:col-span-1\">\r\n                    <div className=\"bg-white dark:bg-zinc-950 p-6 rounded-lg shadow border border-gray-200 dark:border-zinc-800 sticky top-6\">\r\n                        <h2 className=\"text-lg font-medium mb-4\">Nueva Etiqueta</h2>\r\n                        <form action={async (formData: FormData) => {\r\n                            'use server';\r\n                            await createTagWithTenant(formData);\r\n                        }} className=\"space-y-4\">\r\n                            <div>\r\n                                <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700 dark:text-gray-300\">\r\n                                    Nombre\r\n                                </label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    name=\"name\"\r\n                                    id=\"name\"\r\n                                    required\r\n                                    placeholder=\"Ej. Cliente VIP\"\r\n                                    className=\"mt-1 block w-full rounded-md border-gray-300 dark:border-zinc-700 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 bg-transparent border\"\r\n                                />\r\n                            </div>\r\n                            <Button type=\"submit\" className=\"w-full\">\r\n                                Crear Etiqueta\r\n                            </Button>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Tags List */}\r\n                <div className=\"md:col-span-2\">\r\n                    <div className=\"bg-white dark:bg-zinc-950 shadow sm:rounded-lg overflow-hidden border border-gray-200 dark:border-zinc-800\">\r\n                        <table className=\"min-w-full divide-y divide-gray-200 dark:divide-zinc-800\">\r\n                            <thead className=\"bg-gray-50 dark:bg-zinc-900\">\r\n                                <tr>\r\n                                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                        Nombre\r\n                                    </th>\r\n                                    <th scope=\"col\" className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider\">\r\n                                        Contactos\r\n                                    </th>\r\n                                    <th scope=\"col\" className=\"relative px-6 py-3\">\r\n                                        <span className=\"sr-only\">Acciones</span>\r\n                                    </th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"bg-white dark:bg-zinc-950 divide-y divide-gray-200 dark:divide-zinc-800\">\r\n                                {tags.map((tag) => (\r\n                                    <tr key={tag.id}>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white\">\r\n                                            {tag.name}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400\">\r\n                                            {tag._count.contacts}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm font-medium\">\r\n                                            <form action={async () => {\r\n                                                'use server';\r\n                                                await deleteTagWithTenant(tag.id);\r\n                                            }}>\r\n                                                <button type=\"submit\" className=\"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300\">\r\n                                                    Eliminar\r\n                                                </button>\r\n                                            </form>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                                {tags.length === 0 && (\r\n                                    <tr>\r\n                                        <td colSpan={3} className=\"px-6 py-4 text-center text-sm text-gray-500\">\r\n                                            No hay etiquetas registradas.\r\n                                        </td>\r\n                                    </tr>\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","'use server'\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\n\r\nexport async function createTag(tenantId: string, formData: FormData) {\r\n    const name = formData.get('name') as string\r\n\r\n    if (!name || name.trim() === '') {\r\n        return { error: 'Tag name is required' }\r\n    }\r\n\r\n    try {\r\n        await prisma.tag.create({\r\n            data: {\r\n                name: name.trim(),\r\n                tenantId\r\n            }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to create tag:', error)\r\n        return { error: 'Failed to create tag. Name might already exist.' }\r\n    }\r\n\r\n    revalidatePath('/admin/tags')\r\n    revalidatePath('/admin/contacts') // Revalidate contacts as they use tags\r\n}\r\n\r\nexport async function deleteTag(tenantId: string, id: string) {\r\n    if (!id) return\r\n\r\n    try {\r\n        const existing = await prisma.tag.findUnique({ where: { id } })\r\n        if (!existing || existing.tenantId !== tenantId) {\r\n            return { error: 'Access denied' }\r\n        }\r\n\r\n        await prisma.tag.delete({\r\n            where: { id }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to delete tag:', error)\r\n        return { error: 'Failed to delete tag.' }\r\n    }\r\n\r\n    revalidatePath('/admin/tags')\r\n    revalidatePath('/admin/contacts')\r\n}\r\n","export {$$RSC_SERVER_ACTION_0 as '004eab34b3722ccdb34bdc153ae48c8c96bfc525ab'} from 'ACTIONS_MODULE0'\nexport {$$RSC_SERVER_ACTION_1 as '40c35a10bfe5a01a4039b5821e35ece3d90b234ad4'} from 'ACTIONS_MODULE1'\nexport {$$RSC_SERVER_ACTION_0 as '609a259bb3823e280e70195de626895b2771ec418c'} from 'ACTIONS_MODULE1'\nexport {deleteTag as '601c7d9cab7300c2118446a4ae12bab3c76ad29a8d'} from 'ACTIONS_MODULE2'\nexport {createTag as '60e60e0f124ce56c75378f2900f9897e13beb96286'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":"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"}