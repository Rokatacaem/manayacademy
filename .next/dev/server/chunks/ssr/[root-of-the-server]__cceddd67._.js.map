{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/actions/contacts.ts"],"sourcesContent":["'use server'\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { redirect } from \"next/navigation\"\r\n\r\nexport async function createContact(tenantId: string, formData: FormData) {\r\n    const email = formData.get('email') as string\r\n    const firstName = formData.get('firstName') as string\r\n    const lastName = formData.get('lastName') as string\r\n    const tagsInput = formData.get('tags') as string\r\n\r\n    if (!email) {\r\n        throw new Error('Email is required')\r\n    }\r\n\r\n    // Handle Tags (comma separated)\r\n    const tagNames = tagsInput.split(',').map(t => t.trim()).filter(Boolean)\r\n\r\n    try {\r\n        await prisma.contact.create({\r\n            data: {\r\n                tenantId,\r\n                email,\r\n                firstName,\r\n                lastName,\r\n                source: 'Manual Entry',\r\n                tags: {\r\n                    connectOrCreate: tagNames.map(name => ({\r\n                        where: { tenantId_name: { name, tenantId } },\r\n                        create: { name, tenantId }\r\n                    }))\r\n                }\r\n            }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to create contact:', error)\r\n        // Handle duplicate email error\r\n        return { error: 'Failed to create contact. Email might already exist.' }\r\n    }\r\n\r\n    revalidatePath('/admin/contacts')\r\n    redirect('/admin/contacts')\r\n}\r\n\r\nexport async function updateContact(tenantId: string, id: string, formData: FormData) {\r\n    if (!id) return { error: 'ID required' }\r\n\r\n    const email = formData.get('email') as string\r\n    const firstName = formData.get('firstName') as string\r\n    const lastName = formData.get('lastName') as string\r\n    const tagsInput = formData.get('tags') as string\r\n    const status = formData.get('status') as string\r\n\r\n    if (!email) {\r\n        return { error: 'Email is required' }\r\n    }\r\n\r\n    const tagNames = tagsInput.split(',').map(t => t.trim()).filter(Boolean)\r\n\r\n    try {\r\n        // Verify ownership\r\n        const existing = await prisma.contact.findUnique({\r\n            where: { id }\r\n        })\r\n        if (!existing || existing.tenantId !== tenantId) {\r\n            return { error: 'Contact not found or access denied relative to tenant.' }\r\n        }\r\n\r\n        // First disconnect all tags, then connect/create the new ones\r\n        await prisma.contact.update({\r\n            where: { id },\r\n            data: {\r\n                email,\r\n                firstName,\r\n                lastName,\r\n                status,\r\n                tags: {\r\n                    set: [], // Disconnect all existing tags\r\n                    connectOrCreate: tagNames.map(name => ({\r\n                        where: { tenantId_name: { name, tenantId } },\r\n                        create: { name, tenantId }\r\n                    }))\r\n                }\r\n            }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to update contact:', error)\r\n        return { error: 'Failed to update contact.' }\r\n    }\r\n\r\n    revalidatePath('/admin/contacts')\r\n    revalidatePath(`/admin/contacts/${id}`)\r\n    redirect('/admin/contacts')\r\n}\r\n\r\nexport async function deleteContact(tenantId: string, id: string) {\r\n    if (!id) return\r\n\r\n    try {\r\n        const existing = await prisma.contact.findUnique({\r\n            where: { id }\r\n        })\r\n        if (!existing || existing.tenantId !== tenantId) {\r\n            return { error: 'Access denied.' }\r\n        }\r\n\r\n        await prisma.contact.delete({\r\n            where: { id }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to delete contact:', error)\r\n        return { error: 'Failed to delete contact.' }\r\n    }\r\n\r\n    revalidatePath('/admin/contacts')\r\n    redirect('/admin/contacts')\r\n}\r\n\r\nexport async function registerPublicLead(formData: FormData) {\r\n    const email = formData.get('email') as string\r\n    const firstName = formData.get('firstName') as string\r\n\r\n    // In single-tenant production, we use a default tenant or find the first one\r\n    const tenant = await prisma.tenant.findFirst()\r\n    if (!tenant) return { error: 'System not initialized. No tenant found.' }\r\n\r\n    if (!email) return { error: 'Email is required' }\r\n\r\n    try {\r\n        await prisma.contact.upsert({\r\n            where: { tenantId_email: { email, tenantId: tenant.id } },\r\n            update: { firstName },\r\n            create: {\r\n                tenantId: tenant.id,\r\n                email,\r\n                firstName,\r\n                source: 'Web/Landing'\r\n            }\r\n        })\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error('Failed to register lead:', error)\r\n        return { error: 'Registration failed. Please try again.' }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAuHsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,sDAAA"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/app/%28public%29/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useActionState } from \"react\";\r\nimport { registerPublicLead } from \"@/actions/contacts\";\r\nimport Link from \"next/link\";\r\n\r\nexport default function Home() {\r\n    const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');\r\n\r\n    async function handleSubmit(e: React.FormEvent<HTMLFormElement>) {\r\n        e.preventDefault();\r\n        setStatus('loading');\r\n\r\n        const form = e.currentTarget;\r\n        const formData = new FormData(form);\r\n\r\n        if (formData.get('phone_check')) {\r\n            setStatus('success');\r\n            return;\r\n        }\r\n\r\n        const mappedData = new FormData();\r\n        mappedData.append('firstName', formData.get('nombre') as string);\r\n        mappedData.append('email', formData.get('correo') as string);\r\n\r\n        const result = await registerPublicLead(mappedData);\r\n\r\n        if (result?.success) {\r\n            setStatus('success');\r\n            form.reset();\r\n        } else {\r\n            setStatus('error');\r\n        }\r\n    }\r\n\r\n    return (\r\n        <main className=\"center-container\">\r\n            <div className=\"premium-card\">\r\n                <header style={{ marginBottom: '50px' }}>\r\n                    <p style={{ fontSize: '0.7rem', color: 'var(--primary)', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.4em', marginBottom: '15px' }}>\r\n                        Centro de Bienestar Integral\r\n                    </p>\r\n                    <h1 style={{ fontSize: '2.5rem', color: 'var(--text-main)', margin: '0' }}>\r\n                        Ana Katherine Zepeda\r\n                    </h1>\r\n                    <p style={{ fontSize: '1.1rem', color: 'var(--text-light)', fontStyle: 'italic', marginTop: '10px' }}>\r\n                        Psicóloga – Maestra de Yoga – Meditación – Crioterapia\r\n                    </p>\r\n                    <div style={{ width: '60px', height: '1px', background: 'var(--primary)', margin: '30px auto', opacity: '0.2' }}></div>\r\n                </header>\r\n\r\n                <section style={{ marginBottom: '50px', color: 'var(--text-main)', fontSize: '1.15rem', fontWeight: '300' }}>\r\n                    <p>Navegando todo sobre salud mental, física y espiritual.</p>\r\n                    <p style={{ fontSize: '0.95rem', color: 'var(--text-light)', marginTop: '15px' }}>\r\n                        <strong>Desde 2009 a la fecha</strong>, convencida de que menos es más.\r\n                    </p>\r\n                </section>\r\n\r\n                <section style={{ background: 'var(--accent)', padding: '35px', borderRadius: 'var(--radius-md)', textAlign: 'left', marginBottom: '40px' }}>\r\n                    <h3 style={{ margin: '0 0 20px 0', fontSize: '1.1rem', color: 'var(--primary-dark)', textAlign: 'center', letterSpacing: '0.05em' }}>\r\n                        REGÍSTRATE HOY Y RECIBE:\r\n                    </h3>\r\n                    <ul className=\"wellness-list\">\r\n                        <li>Audio para aprender a meditar.</li>\r\n                        <li>Datos prácticos de salud.</li>\r\n                        <li>Reflexiones para personas que buscan algo mejor en la vida.</li>\r\n                        <li>Acceso anticipado a lanzamientos y regalos.</li>\r\n                    </ul>\r\n                </section>\r\n\r\n                <section>\r\n                    <p style={{ fontSize: '1rem', fontWeight: '600', color: 'var(--text-main)', marginBottom: '25px' }}>Te leo</p>\r\n\r\n                    {status === 'success' ? (\r\n                        <div className=\"msg-container msg-success\">\r\n                            ¡Gracias por conectar! Ya estás en mi lista especial.\r\n                        </div>\r\n                    ) : (\r\n                        <form onSubmit={handleSubmit}>\r\n                            <input type=\"text\" name=\"phone_check\" className=\"hp-field\" tabIndex={-1} autoComplete=\"off\" style={{ display: 'none' }} />\r\n\r\n                            <div className=\"input-group\">\r\n                                <label className=\"input-label\">Tu nombre</label>\r\n                                <input type=\"text\" name=\"nombre\" placeholder=\"¿Cómo te llamas?\" required disabled={status === 'loading'} />\r\n                            </div>\r\n                            <div className=\"input-group\">\r\n                                <label className=\"input-label\">Tu correo electrónico</label>\r\n                                <input type=\"email\" name=\"correo\" placeholder=\"ejemplo@correo.com\" required disabled={status === 'loading'} />\r\n                            </div>\r\n\r\n                            <button type=\"submit\" className=\"btn-primary\" disabled={status === 'loading'}>\r\n                                {status === 'loading' ? 'CONECTANDO...' : 'REGISTRARME'}\r\n                            </button>\r\n\r\n                            {status === 'error' && (\r\n                                <div className=\"msg-container msg-error\">\r\n                                    Lo siento, algo falló. ¿Podrías intentar de nuevo?\r\n                                </div>\r\n                            )}\r\n                        </form>\r\n                    )}\r\n\r\n                    <p style={{ fontSize: '0.75rem', color: 'var(--text-muted)', marginTop: '25px' }}>\r\n                        Acepto la política de privacidad\r\n                    </p>\r\n\r\n                    <footer style={{ marginTop: '40px', paddingTop: '30px', borderTop: '1px solid #f1f5f9' }}>\r\n                        <Link href=\"/login\" style={{ fontSize: '0.65rem', color: 'var(--text-muted)', textDecoration: 'none', textTransform: 'uppercase', letterSpacing: '0.3em', fontWeight: 'bold' }}>\r\n                            Acceso Alumnos / Admin\r\n                        </Link>\r\n                    </footer>\r\n                </section>\r\n            </div>\r\n        </main>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}