{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/auth.config.ts"],"sourcesContent":["\r\nimport type { NextAuthConfig } from \"next-auth\"\r\nimport Credentials from \"next-auth/providers/credentials\"\r\n\r\nexport default {\r\n    secret: process.env.AUTH_SECRET ?? \"manay-academy-secret-2026-local\",\r\n    providers: [\r\n        Credentials({\r\n            credentials: {\r\n                email: { label: \"Email\", type: \"email\" },\r\n                password: { label: \"Password\", type: \"password\" },\r\n            },\r\n            authorize: async (credentials) => {\r\n                return null; // Logic is in auth.ts\r\n            },\r\n        }),\r\n    ],\r\n    pages: {\r\n        signIn: '/login', // Will be dynamic in middleware\r\n    },\r\n    callbacks: {\r\n        authorized({ auth, request: { nextUrl } }) {\r\n            const isLoggedIn = !!auth?.user;\r\n            const isOnAdmin = nextUrl.pathname.startsWith('/admin');\r\n            if (isOnAdmin) {\r\n                if (isLoggedIn) return true;\r\n                return false; // Redirect unauthenticated users to login page\r\n            }\r\n            return true;\r\n        },\r\n    },\r\n} satisfies NextAuthConfig\r\n"],"names":[],"mappings":";;;;AAEA;AAAA;;uCAEe;IACX,QAAQ,QAAQ,GAAG,CAAC,WAAW,IAAI;IACnC,WAAW;QACP,IAAA,qKAAW,EAAC;YACR,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,WAAW,OAAO;gBACd,OAAO,MAAM,sBAAsB;YACvC;QACJ;KACH;IACD,OAAO;QACH,QAAQ;IACZ;IACA,WAAW;QACP,YAAW,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,EAAE;YACrC,MAAM,aAAa,CAAC,CAAC,MAAM;YAC3B,MAAM,YAAY,QAAQ,QAAQ,CAAC,UAAU,CAAC;YAC9C,IAAI,WAAW;gBACX,IAAI,YAAY,OAAO;gBACvB,OAAO,OAAO,+CAA+C;YACjE;YACA,OAAO;QACX;IACJ;AACJ"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/auth.ts"],"sourcesContent":["\r\nimport NextAuth from \"next-auth\"\r\nimport Credentials from \"next-auth/providers/credentials\"\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { z } from \"zod\"\r\nimport authConfig from \"./auth.config\"\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth({\r\n    // NO adapter: with JWT strategy + Credentials, adapter is not needed and causes conflicts\r\n    secret: process.env.AUTH_SECRET ?? \"manay-academy-secret-2026-local\",\r\n    session: { strategy: \"jwt\" },\r\n    ...authConfig,\r\n    providers: [\r\n        Credentials({\r\n            async authorize(credentials) {\r\n                const parsedCredentials = z\r\n                    .object({ email: z.string().email(), password: z.string().min(6), tenantId: z.string() })\r\n                    .safeParse(credentials);\r\n\r\n                if (parsedCredentials.success) {\r\n                    const { email, password, tenantId } = parsedCredentials.data;\r\n\r\n                    const user = await prisma.user.findFirst({\r\n                        where: { email, tenantId },\r\n                    });\r\n\r\n                    if (!user) return null;\r\n                    if (!user.password) return null; // OAuth user\r\n\r\n                    const passwordsMatch = await bcrypt.compare(password, user.password);\r\n                    if (passwordsMatch) return user;\r\n                }\r\n\r\n                console.log(\"Invalid credentials\");\r\n                return null;\r\n            },\r\n        }),\r\n    ],\r\n    callbacks: {\r\n        async jwt({ token, user }) {\r\n            if (user) {\r\n                token.id = user.id;\r\n                token.tenantId = (user as any).tenantId;\r\n                token.role = (user as any).role;\r\n            }\r\n            return token;\r\n        },\r\n        async session({ session, token }) {\r\n            if (token && session.user) {\r\n                session.user.id = token.id as string;\r\n                (session.user as any).tenantId = token.tenantId;\r\n                (session.user as any).role = token.role;\r\n            }\r\n            return session;\r\n        }\r\n    }\r\n})\r\n"],"names":[],"mappings":";;;;;;;;;;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,gKAAQ,EAAC;IACxD,0FAA0F;IAC1F,QAAQ,QAAQ,GAAG,CAAC,WAAW,IAAI;IACnC,SAAS;QAAE,UAAU;IAAM;IAC3B,GAAG,gIAAU;IACb,WAAW;QACP,IAAA,qKAAW,EAAC;YACR,MAAM,WAAU,WAAW;gBACvB,MAAM,oBAAoB,kLAAC,CACtB,MAAM,CAAC;oBAAE,OAAO,kLAAC,CAAC,MAAM,GAAG,KAAK;oBAAI,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;oBAAI,UAAU,kLAAC,CAAC,MAAM;gBAAG,GACtF,SAAS,CAAC;gBAEf,IAAI,kBAAkB,OAAO,EAAE;oBAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,kBAAkB,IAAI;oBAE5D,MAAM,OAAO,MAAM,8HAAM,CAAC,IAAI,CAAC,SAAS,CAAC;wBACrC,OAAO;4BAAE;4BAAO;wBAAS;oBAC7B;oBAEA,IAAI,CAAC,MAAM,OAAO;oBAClB,IAAI,CAAC,KAAK,QAAQ,EAAE,OAAO,MAAM,aAAa;oBAE9C,MAAM,iBAAiB,MAAM,4IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;oBACnE,IAAI,gBAAgB,OAAO;gBAC/B;gBAEA,QAAQ,GAAG,CAAC;gBACZ,OAAO;YACX;QACJ;KACH;IACD,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACrB,IAAI,MAAM;gBACN,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,QAAQ,GAAG,AAAC,KAAa,QAAQ;gBACvC,MAAM,IAAI,GAAG,AAAC,KAAa,IAAI;YACnC;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,SAAS,QAAQ,IAAI,EAAE;gBACvB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBACzB,QAAQ,IAAI,CAAS,QAAQ,GAAG,MAAM,QAAQ;gBAC9C,QAAQ,IAAI,CAAS,IAAI,GAAG,MAAM,IAAI;YAC3C;YACA,OAAO;QACX;IACJ;AACJ"}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/app/tenant/%5Bslug%5D/admin/page.tsx"],"sourcesContent":["import { auth } from \"@/auth\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport Link from \"next/link\";\r\n\r\nexport default async function AdminDashboard() {\r\n    const session = await auth();\r\n    const tenantId = (session?.user as any)?.tenantId;\r\n\r\n    const [contactCount, courseCount] = await Promise.all([\r\n        prisma.contact.count({ where: { tenantId } }),\r\n        prisma.course.count({ where: { tenantId } }),\r\n    ]);\r\n\r\n    const recentContacts = await prisma.contact.findMany({\r\n        where: { tenantId },\r\n        orderBy: { createdAt: 'desc' },\r\n        take: 5,\r\n        select: { id: true, firstName: true, lastName: true, email: true, createdAt: true },\r\n    });\r\n\r\n    return (\r\n        <div>\r\n            <div style={{ marginBottom: '40px' }}>\r\n                <p style={{ fontSize: '0.7rem', color: '#7c9082', fontWeight: '700', textTransform: 'uppercase', letterSpacing: '0.3em', marginBottom: '8px' }}>\r\n                    Centro de Bienestar Integral\r\n                </p>\r\n                <h1 style={{ fontSize: '2rem', color: '#2c3e50', margin: '0', fontWeight: '400' }}>\r\n                    Panel de Control\r\n                </h1>\r\n                <p style={{ color: '#64748b', marginTop: '8px' }}>\r\n                    Bienvenida, {session?.user?.name ?? 'Ana'}\r\n                </p>\r\n            </div>\r\n\r\n            {/* KPI Cards */}\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '24px', marginBottom: '48px' }}>\r\n                <div style={{ background: 'white', padding: '32px', borderRadius: '20px', boxShadow: '0 4px 20px rgba(0,0,0,0.04)', borderTop: '4px solid #7c9082' }}>\r\n                    <p style={{ fontSize: '0.7rem', fontWeight: '700', color: '#94a3b8', textTransform: 'uppercase', letterSpacing: '0.2em', margin: '0 0 12px' }}>Total Contactos</p>\r\n                    <p style={{ fontSize: '3rem', fontWeight: '300', color: '#2c3e50', margin: '0', lineHeight: '1' }}>{contactCount}</p>\r\n                </div>\r\n                <div style={{ background: 'white', padding: '32px', borderRadius: '20px', boxShadow: '0 4px 20px rgba(0,0,0,0.04)', borderTop: '4px solid #d6d2c4' }}>\r\n                    <p style={{ fontSize: '0.7rem', fontWeight: '700', color: '#94a3b8', textTransform: 'uppercase', letterSpacing: '0.2em', margin: '0 0 12px' }}>Cursos Activos</p>\r\n                    <p style={{ fontSize: '3rem', fontWeight: '300', color: '#2c3e50', margin: '0', lineHeight: '1' }}>{courseCount}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Recent Contacts */}\r\n            <div style={{ background: 'white', borderRadius: '20px', boxShadow: '0 4px 20px rgba(0,0,0,0.04)', overflow: 'hidden' }}>\r\n                <div style={{ padding: '24px 32px', borderBottom: '1px solid #f1f5f9', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <h2 style={{ margin: '0', fontSize: '1rem', fontWeight: '600', color: '#2c3e50' }}>Últimos Contactos</h2>\r\n                    <Link href=\"/admin/contacts\" style={{ fontSize: '0.75rem', color: '#7c9082', textDecoration: 'none', fontWeight: '600' }}>\r\n                        Ver todos →\r\n                    </Link>\r\n                </div>\r\n                <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                    <thead>\r\n                        <tr style={{ background: '#faf9f6' }}>\r\n                            <th style={{ padding: '12px 32px', textAlign: 'left', fontSize: '0.65rem', fontWeight: '700', color: '#94a3b8', textTransform: 'uppercase', letterSpacing: '0.15em' }}>Nombre</th>\r\n                            <th style={{ padding: '12px 32px', textAlign: 'left', fontSize: '0.65rem', fontWeight: '700', color: '#94a3b8', textTransform: 'uppercase', letterSpacing: '0.15em' }}>Email</th>\r\n                            <th style={{ padding: '12px 32px', textAlign: 'left', fontSize: '0.65rem', fontWeight: '700', color: '#94a3b8', textTransform: 'uppercase', letterSpacing: '0.15em' }}>Registro</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        {recentContacts.length === 0 ? (\r\n                            <tr>\r\n                                <td colSpan={3} style={{ padding: '40px', textAlign: 'center', color: '#94a3b8', fontSize: '0.9rem' }}>\r\n                                    Aún no hay contactos registrados\r\n                                </td>\r\n                            </tr>\r\n                        ) : recentContacts.map((c, i) => (\r\n                            <tr key={c.id} style={{ borderTop: '1px solid #f8f9fa' }}>\r\n                                <td style={{ padding: '16px 32px', fontSize: '0.9rem', color: '#2c3e50', fontWeight: '500' }}>\r\n                                    {c.firstName} {c.lastName ?? ''}\r\n                                </td>\r\n                                <td style={{ padding: '16px 32px', fontSize: '0.85rem', color: '#64748b' }}>{c.email}</td>\r\n                                <td style={{ padding: '16px 32px', fontSize: '0.8rem', color: '#94a3b8' }}>\r\n                                    {new Date(c.createdAt).toLocaleDateString('es-CL')}\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}