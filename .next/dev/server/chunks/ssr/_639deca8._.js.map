{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient }\r\n\r\nconsole.log('Initializing Prisma Client. DB URL:', process.env.DATABASE_URL)\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAExB,QAAQ,GAAG,CAAC,uCAAuC,QAAQ,GAAG,CAAC,YAAY;AACpE,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/actions/contacts.ts"],"sourcesContent":["'use server'\r\n\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport { revalidatePath } from \"next/cache\"\r\nimport { redirect } from \"next/navigation\"\r\n\r\nexport async function createContact(tenantId: string, formData: FormData) {\r\n    const email = formData.get('email') as string\r\n    const firstName = formData.get('firstName') as string\r\n    const lastName = formData.get('lastName') as string\r\n    const tagsInput = formData.get('tags') as string\r\n\r\n    if (!email) {\r\n        throw new Error('Email is required')\r\n    }\r\n\r\n    // Handle Tags (comma separated)\r\n    const tagNames = tagsInput.split(',').map(t => t.trim()).filter(Boolean)\r\n\r\n    try {\r\n        await prisma.contact.create({\r\n            data: {\r\n                tenantId,\r\n                email,\r\n                firstName,\r\n                lastName,\r\n                source: 'Manual Entry',\r\n                tags: {\r\n                    connectOrCreate: tagNames.map(name => ({\r\n                        where: { tenantId_name: { name, tenantId } },\r\n                        create: { name, tenantId }\r\n                    }))\r\n                }\r\n            }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to create contact:', error)\r\n        // Handle duplicate email error\r\n        return { error: 'Failed to create contact. Email might already exist.' }\r\n    }\r\n\r\n    revalidatePath('/admin/contacts')\r\n    redirect('/admin/contacts')\r\n}\r\n\r\nexport async function updateContact(tenantId: string, id: string, formData: FormData) {\r\n    if (!id) return { error: 'ID required' }\r\n\r\n    const email = formData.get('email') as string\r\n    const firstName = formData.get('firstName') as string\r\n    const lastName = formData.get('lastName') as string\r\n    const tagsInput = formData.get('tags') as string\r\n    const status = formData.get('status') as string\r\n\r\n    if (!email) {\r\n        return { error: 'Email is required' }\r\n    }\r\n\r\n    const tagNames = tagsInput.split(',').map(t => t.trim()).filter(Boolean)\r\n\r\n    try {\r\n        // Verify ownership\r\n        const existing = await prisma.contact.findUnique({\r\n            where: { id }\r\n        })\r\n        if (!existing || existing.tenantId !== tenantId) {\r\n            return { error: 'Contact not found or access denied relative to tenant.' }\r\n        }\r\n\r\n        // First disconnect all tags, then connect/create the new ones\r\n        await prisma.contact.update({\r\n            where: { id },\r\n            data: {\r\n                email,\r\n                firstName,\r\n                lastName,\r\n                status,\r\n                tags: {\r\n                    set: [], // Disconnect all existing tags\r\n                    connectOrCreate: tagNames.map(name => ({\r\n                        where: { tenantId_name: { name, tenantId } },\r\n                        create: { name, tenantId }\r\n                    }))\r\n                }\r\n            }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to update contact:', error)\r\n        return { error: 'Failed to update contact.' }\r\n    }\r\n\r\n    revalidatePath('/admin/contacts')\r\n    revalidatePath(`/admin/contacts/${id}`)\r\n    redirect('/admin/contacts')\r\n}\r\n\r\nexport async function deleteContact(tenantId: string, id: string) {\r\n    if (!id) return\r\n\r\n    try {\r\n        const existing = await prisma.contact.findUnique({\r\n            where: { id }\r\n        })\r\n        if (!existing || existing.tenantId !== tenantId) {\r\n            return { error: 'Access denied.' }\r\n        }\r\n\r\n        await prisma.contact.delete({\r\n            where: { id }\r\n        })\r\n    } catch (error) {\r\n        console.error('Failed to delete contact:', error)\r\n        return { error: 'Failed to delete contact.' }\r\n    }\r\n\r\n    revalidatePath('/admin/contacts')\r\n    redirect('/admin/contacts')\r\n}\r\n\r\nexport async function registerPublicLead(formData: FormData) {\r\n    const email = formData.get('email') as string\r\n    const firstName = formData.get('firstName') as string\r\n\r\n    // In single-tenant production, we use a default tenant or find the first one\r\n    const tenant = await prisma.tenant.findFirst()\r\n    if (!tenant) return { error: 'System not initialized. No tenant found.' }\r\n\r\n    if (!email) return { error: 'Email is required' }\r\n\r\n    try {\r\n        await prisma.contact.upsert({\r\n            where: { tenantId_email: { email, tenantId: tenant.id } },\r\n            update: { firstName },\r\n            create: {\r\n                tenantId: tenant.id,\r\n                email,\r\n                firstName,\r\n                source: 'Web/Landing'\r\n            }\r\n        })\r\n        return { success: true }\r\n    } catch (error) {\r\n        console.error('Failed to register lead:', error)\r\n        return { error: 'Registration failed. Please try again.' }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/.next-internal/server/app/%28public%29/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {registerPublicLead as '40dfe6847e66df1e3c408ed447db04fca47a9e0b2d'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}