{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/auth.config.ts"],"sourcesContent":["\r\nimport type { NextAuthConfig } from \"next-auth\"\r\nimport Credentials from \"next-auth/providers/credentials\"\r\n\r\nexport default {\r\n    providers: [\r\n        Credentials({\r\n            credentials: {\r\n                email: { label: \"Email\", type: \"email\" },\r\n                password: { label: \"Password\", type: \"password\" },\r\n            },\r\n            authorize: async (credentials) => {\r\n                return null; // Logic is in auth.ts\r\n            },\r\n        }),\r\n    ],\r\n    pages: {\r\n        signIn: '/login', // Will be dynamic in middleware\r\n    },\r\n    callbacks: {\r\n        authorized({ auth, request: { nextUrl } }) {\r\n            const isLoggedIn = !!auth?.user;\r\n            const isOnAdmin = nextUrl.pathname.startsWith('/admin');\r\n            if (isOnAdmin) {\r\n                if (isLoggedIn) return true;\r\n                return false; // Redirect unauthenticated users to login page\r\n            }\r\n            return true;\r\n        },\r\n    },\r\n} satisfies NextAuthConfig\r\n"],"names":[],"mappings":";;;;AAEA;AAAA;;uCAEe;IACX,WAAW;QACP,IAAA,qKAAW,EAAC;YACR,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,WAAW,OAAO;gBACd,OAAO,MAAM,sBAAsB;YACvC;QACJ;KACH;IACD,OAAO;QACH,QAAQ;IACZ;IACA,WAAW;QACP,YAAW,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,EAAE;YACrC,MAAM,aAAa,CAAC,CAAC,MAAM;YAC3B,MAAM,YAAY,QAAQ,QAAQ,CAAC,UAAU,CAAC;YAC9C,IAAI,WAAW;gBACX,IAAI,YAAY,OAAO;gBACvB,OAAO,OAAO,+CAA+C;YACjE;YACA,OAAO;QACX;IACJ;AACJ"}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/auth.ts"],"sourcesContent":["\r\nimport NextAuth from \"next-auth\"\r\nimport Credentials from \"next-auth/providers/credentials\"\r\nimport { PrismaAdapter } from \"@auth/prisma-adapter\"\r\nimport { prisma } from \"@/lib/prisma\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { z } from \"zod\"\r\nimport authConfig from \"./auth.config\"\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth({\r\n    adapter: PrismaAdapter(prisma),\r\n    session: { strategy: \"jwt\" },\r\n    ...authConfig,\r\n    providers: [\r\n        Credentials({\r\n            async authorize(credentials) {\r\n                const parsedCredentials = z\r\n                    .object({ email: z.string().email(), password: z.string().min(6), tenantId: z.string() })\r\n                    .safeParse(credentials);\r\n\r\n                if (parsedCredentials.success) {\r\n                    const { email, password, tenantId } = parsedCredentials.data;\r\n\r\n                    const user = await prisma.user.findFirst({\r\n                        where: { email, tenantId },\r\n                    });\r\n\r\n                    if (!user) return null;\r\n                    if (!user.password) return null; // OAuth user\r\n\r\n                    const passwordsMatch = await bcrypt.compare(password, user.password);\r\n                    if (passwordsMatch) return user;\r\n                }\r\n\r\n                console.log(\"Invalid credentials\");\r\n                return null;\r\n            },\r\n        }),\r\n    ],\r\n    callbacks: {\r\n        async jwt({ token, user, trigger, session }) {\r\n            if (user) {\r\n                // User is available on sign in\r\n                // We need to fetch the tenant slug or similar if we want it in the token\r\n                // But for now, let's just add the user id and maybe role/tenantId\r\n\r\n                // However, user object from authorize might not have everything if not explicitly returned?\r\n                // PrismaAdapter returns user from DB, so it should have fields.\r\n                token.id = user.id;\r\n                // @ts-ignore\r\n                token.tenantId = user.tenantId;\r\n                // @ts-ignore\r\n                token.role = user.role;\r\n            }\r\n            return token;\r\n        },\r\n        async session({ session, token }) {\r\n            if (token && session.user) {\r\n                session.user.id = token.id as string;\r\n                // @ts-ignore\r\n                session.user.tenantId = token.tenantId as string;\r\n                // @ts-ignore\r\n                session.user.role = token.role as string;\r\n            }\r\n            return session;\r\n        }\r\n    }\r\n})\r\n"],"names":[],"mappings":";;;;;;;;;;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,gKAAQ,EAAC;IACxD,SAAS,IAAA,qKAAa,EAAC,8HAAM;IAC7B,SAAS;QAAE,UAAU;IAAM;IAC3B,GAAG,gIAAU;IACb,WAAW;QACP,IAAA,qKAAW,EAAC;YACR,MAAM,WAAU,WAAW;gBACvB,MAAM,oBAAoB,kLAAC,CACtB,MAAM,CAAC;oBAAE,OAAO,kLAAC,CAAC,MAAM,GAAG,KAAK;oBAAI,UAAU,kLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;oBAAI,UAAU,kLAAC,CAAC,MAAM;gBAAG,GACtF,SAAS,CAAC;gBAEf,IAAI,kBAAkB,OAAO,EAAE;oBAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,kBAAkB,IAAI;oBAE5D,MAAM,OAAO,MAAM,8HAAM,CAAC,IAAI,CAAC,SAAS,CAAC;wBACrC,OAAO;4BAAE;4BAAO;wBAAS;oBAC7B;oBAEA,IAAI,CAAC,MAAM,OAAO;oBAClB,IAAI,CAAC,KAAK,QAAQ,EAAE,OAAO,MAAM,aAAa;oBAE9C,MAAM,iBAAiB,MAAM,4IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;oBACnE,IAAI,gBAAgB,OAAO;gBAC/B;gBAEA,QAAQ,GAAG,CAAC;gBACZ,OAAO;YACX;QACJ;KACH;IACD,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE;YACvC,IAAI,MAAM;gBACN,+BAA+B;gBAC/B,yEAAyE;gBACzE,kEAAkE;gBAElE,4FAA4F;gBAC5F,gEAAgE;gBAChE,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,aAAa;gBACb,MAAM,QAAQ,GAAG,KAAK,QAAQ;gBAC9B,aAAa;gBACb,MAAM,IAAI,GAAG,KAAK,IAAI;YAC1B;YACA,OAAO;QACX;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,SAAS,QAAQ,IAAI,EAAE;gBACvB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,aAAa;gBACb,QAAQ,IAAI,CAAC,QAAQ,GAAG,MAAM,QAAQ;gBACtC,aAAa;gBACb,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAClC;YACA,OAAO;QACX;IACJ;AACJ"}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/src/lib/actions.ts"],"sourcesContent":["\r\n'use server'\r\n\r\nimport { signIn } from '@/auth'\r\nimport { AuthError } from 'next-auth'\r\n\r\nexport async function authenticate(\r\n    prevState: string | undefined,\r\n    formData: FormData,\r\n) {\r\n    try {\r\n        const slug = formData.get('slug') as string;\r\n        const { prisma } = await import('@/lib/prisma');\r\n\r\n        let tenant;\r\n        if (slug) {\r\n            tenant = await prisma.tenant.findUnique({ where: { slug } });\r\n        } else {\r\n            // Single-tenant fallback: get the first active tenant\r\n            tenant = await prisma.tenant.findFirst();\r\n        }\r\n\r\n        if (!tenant) return 'System not initialized. Please run seeds.';\r\n\r\n        await signIn('credentials', {\r\n            ...Object.fromEntries(formData),\r\n            tenantId: tenant.id,\r\n            redirectTo: '/admin',\r\n        });\r\n\r\n    } catch (error) {\r\n        if (error instanceof AuthError) {\r\n            switch (error.type) {\r\n                case 'CredentialsSignin':\r\n                    return 'Invalid credentials.'\r\n                default:\r\n                    return 'Something went wrong.'\r\n            }\r\n        }\r\n        throw error\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AACA;AAAA;;;;;AAEO,eAAe,aAClB,SAA6B,EAC7B,QAAkB;IAElB,IAAI;QACA,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,EAAE,MAAM,EAAE,GAAG;QAEnB,IAAI;QACJ,IAAI,MAAM;YACN,SAAS,MAAM,OAAO,MAAM,CAAC,UAAU,CAAC;gBAAE,OAAO;oBAAE;gBAAK;YAAE;QAC9D,OAAO;YACH,sDAAsD;YACtD,SAAS,MAAM,OAAO,MAAM,CAAC,SAAS;QAC1C;QAEA,IAAI,CAAC,QAAQ,OAAO;QAEpB,MAAM,IAAA,qHAAM,EAAC,eAAe;YACxB,GAAG,OAAO,WAAW,CAAC,SAAS;YAC/B,UAAU,OAAO,EAAE;YACnB,YAAY;QAChB;IAEJ,EAAE,OAAO,OAAO;QACZ,IAAI,iBAAiB,qJAAS,EAAE;YAC5B,OAAQ,MAAM,IAAI;gBACd,KAAK;oBACD,OAAO;gBACX;oBACI,OAAO;YACf;QACJ;QACA,MAAM;IACV;AACJ;;;IAnCsB;;AAAA,+OAAA"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/rokat/OneDrive/Proyectos/ManayAcademy/.next-internal/server/app/tenant/%5Bslug%5D/login/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {authenticate as '6082d231c964b36c807ceab3942d2c532a2bf6bd01'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}